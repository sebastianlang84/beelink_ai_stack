api:
  youtube_api_key: ${YOUTUBE_API_KEY} # API-Schlüssel aus Umgebungsvariable YOUTUBE_API_KEY laden
  # Cookies absichtlich deaktiviert (privacy-safe); Rate-Limit-Strategie nutzen.
  youtube_cookies: null

# YouTube-Konfiguration
youtube:
  channels:
    - "@bravosresearchcrypto"
    - "@thepatientinvestorr"


  # Filteroptionen (Schema-konform)
  num_videos: 1
  lookback_days: 3
  max_videos_per_channel: 1
  # Wichtig: leeres `keywords:` wird von YAML als `null` geparst und scheitert
  # dann an der Pydantic-Validierung (erwartet: list[string]).
  keywords: []
  
  # Rate-Limit-Strategie (ohne Cookies)
  min_delay_s: 3.0
  jitter_s: 2.0
  max_retries: 3
  backoff_base_s: 2.0
  backoff_cap_s: 60.0
  # PROXY-KONFIGURATION (Deaktiviert, da Credentials ungültig/abgelaufen)
  proxy:
    mode: none
    # webshare_username: "<set locally>"
    # webshare_password: "<set locally>"
    filter_ip_locations: [] # z.B. ["us", "de"]
  

# Ausgabe-Konfiguration
output:
  # Globales Output-Layout (empfohlen):
  # - global: gemeinsames Root-Verzeichnis
  # - topic: Topic/Namespace für Reports/History/Index
  global: /home/wasti/ai_stack_data/transcript-miner/output
  topic: investing_test
  metadata: true
  write_timeout_report: true

# Logging-Konfiguration
logging:
  level: DEBUG #INFO, DEBUG, ERROR, CRITICAL
  file: ../logs/investing_test.log
  error_log_file: ../logs/investing_test-error.log
  rotation_enabled: true
  rotation_when: D
  rotation_interval: 1
  rotation_backup_count: 3

# Optional: LLM-Analyse (ein Job pro Run).
# Aktivierung erfordert OpenRouter-Key via `api.openrouter_api_key` oder Env `OPENROUTER_API_KEY`.
analysis:
  llm:
    enabled: true
    mode: per_video
    model: google/gemini-1.5-flash
    # Aggregation fail-fast: benötigt aktuell vollständige Summary-Coverage für alle
    # Transkripte im Index. Default ist 20; das kann Channels/Video-IDs auslassen.
    # Daher erhöhen wir das Limit, sodass fehlende Summaries nachgezogen werden.
    max_transcripts: 200
    max_input_tokens: 320000
    max_output_tokens: 80000
    per_video_concurrency: 1
    per_video_min_delay_s: 1.0
    per_video_jitter_s: 0.5
    reasoning_effort: high
    # Streaming: Summaries parallel zum Transcript-Download
    stream_summaries: true
    stream_worker_concurrency: 1
    stream_queue_size: 100
    system_prompt: |
      You are a financial transcript analyst creating RAG-optimized, topic-isolated summaries.

      TASK
      From EXACTLY ONE video transcript, produce up to 3 separate Markdown documents:
      1) macro
      2) stocks
      3) crypto

      Only create a document if the transcript contains meaningful content for that topic.
      Do NOT create empty-topic documents.

      GLOBAL HARD RULES
      - Output ONLY Markdown.
      - No JSON, no code fences, no intro text.
      - Use ONLY transcript content (no external facts).
      - Same language as transcript.
      - Be concrete, compact, evidence-based.
      - Never guess. Unknowns must be explicit.
      - Do not mix topics inside one document.

      OUTPUT FORMAT
      Return documents in this exact wrapper format:

      <<<DOC_START>>>
      ---
      doc_type: rag_topic_summary
      topic: <macro|stocks|crypto>
      video_id: <video_id>
      title: <title>
      channel_namespace: <channel_namespace>
      url: <url>
      published_at: <YYYY-MM-DD HH:MM UTC or unknown>
      fetched_at: <YYYY-MM-DD HH:MM UTC or unknown>
      assets: [<asset1>, <asset2>]   # [] if none
      keywords: [<k1>, <k2>, <k3>]   # topic-relevant retrieval hints
      ---
      # <Topic Label>: <short title>

      ## Executive Summary
      - 3-6 bullets, only this topic.

      ## Key Points
      - One fact per bullet.
      - Include short inline evidence quote in parentheses when possible (max 180 chars).

      ## Numbers
      - metric: <name> | value: <value> | unit: <unit> | context: <short context>
      - If none: - none

      ## Opportunities
      - Topic-specific upside points only.
      - If none: - none

      ## Risks
      - Topic-specific downside points only.
      - If none: - none

      ## Unknowns
      - Missing / unclear points from transcript only.
      - If none: - none

      ## IST-Stand
      - Current state described in transcript (not your external knowledge).
      <<<DOC_END>>>

      TOPIC BOUNDARY RULES
      - macro doc: rates, inflation, liquidity, central banks, fiscal/tariff/geopolitics, yield curve, DXY, growth/recession.
      - stocks doc: equities, companies, earnings, valuation, guidance, sectors, positioning.
      - crypto doc: BTC/ETH/altcoins, on-chain, regulation, exchange flows, crypto narratives.

      CROSS-TOPIC RULE
      - If a dependency exists, keep main claim in-topic and add ONE short cross-reference bullet:
        "Cross-topic note: related macro/stocks/crypto driver mentioned."
      - No long mixed explanation.

      QUALITY BAR
      - Prefer fewer high-signal bullets over many vague bullets.
      - No filler, no motivational language, no generic market commentary.
    user_prompt_template: |
      Create up to 3 topic-isolated RAG documents for this one transcript.

      Video metadata:
      - topic: {topic}
      - video_id: {video_id}
      - url: {url}
      - title: {title}
      - channel_namespace: {channel_namespace}
      - published_at: {published_at}
      - fetched_at: {fetched_at}

      Transcript:
      {transcript}

# Report-Generierung
report:
  llm:
    model: openai/gpt-5.2
    timeout_s: 360
    system_prompt:
      de: |
        Du bist ein Analyst für Investing (Aktien, Makro, Krypto).

        OUTPUT:
        - Schreibe Markdown (kein JSON).
        - Folge exakt dieser Struktur/Überschriften (keine Umbenennungen).
        - Kurze Sätze. Bulletpoints. Keine Füllwörter.
        - Keine externen Fakten. Keine erfundenen Zahlen. Alles muss aus den Aggregatdaten kommen.
        - Wenn Infos fehlen: schreibe "unknown" oder lasse es aus (nicht raten).
        - Quellenformat (pflicht): Channel + Video-Titel + Video-ID (wenn Titel fehlt: Channel + Video-ID).

        INPUT:
        - Du erhältst aggregierte Per-Video-Summaries (Markdown-only) mit festen Sections:
          * Summary
          * Key Points & Insights
          * Numbers
          * Chances
          * Risks
          * Unknowns
        - Nutze diese Felder als Wissensbasis; keine externen Fakten ergänzen.

        DEFINITIONEN:
        - "Channel" = channel_namespace.
        - "Evidence" = wörtliche Quotes aus den Extracts.

        PRIORISIERUNG:
        - Stocks: priorisiere nach (1) Anzahl unterschiedlicher Channels, (2) Substanz/Evidence, (3) Recency falls vorhanden.
        - Macro/Crypto: priorisiere nach wiederkehrenden Aussagen + klaren Szenarien.

        REPORT-TEMPLATE (exakt):

        # Channel Market Digest — Stocks / Macro / Crypto

        ## 0) Meta
        - Run ID: ...
        - Report-Datum (Europe/Vienna): ...
        - Zeitraum (Primär): ...
        - Zeitraum (Kontext): ...
        ### 0.1 Coverage & Datenbasis
        ### 0.2 Bias-Warnungen (Kurz)

        # 1) Stocks — Channel Stock Radar
        ## 1.1 Coverage Map (schnell)
        ### 1.1.1 Top Themen/Sektoren
        ### 1.1.2 Top Ticker/Companies (Recency + Breite)
        ### 1.1.3 Neu / Re-Rating / Drop

        ## 1.2 “Thesis Cards” pro Top-Aktie (max 8–12)
        (pro Aktie:)
        - Kurzprofil (1 Satz)
        - Warum bullisch? (3 Punkte, mit Channel-Verweis)
        - Warum bearisch? (3 Punkte, mit Channel-Verweis)
        - Katalysatoren (kurzfristig / mittelfristig)
        - Kill-Switch (2–3 harte Kriterien; wenn nicht vorhanden → "unknown")
        - Evidence (IDs aus Appendix)

        ## 1.3 Channel-Overlay (dein “Lieblings-Blick”)
        (pro Channel:)
        - Top 5 Picks / Top 5 Avoids (aus dem Material ableitbar; sonst "unknown")
        - Wiederkehrende Muster (1–3 Punkte)

        ## 1.4 Stocks Mentioned (non Deep-Dive)
        - Pro Aktie: 1–3 Sätze Zusammenfassung + 1 Evidence-ID

        ## 1.5 Numbers / Multiples / Levels
        - Liste der wichtigsten Zahlen (mit Kontext + Einheit + Evidence-ID)

        ## 1.6 Other Insights
        - Kurze Bulletpoints (Topic + 1 Satz + Evidence-ID)

        # 2) Macro — Ausblick & Szenarien
        ## 2.1 One-Pager: “Was ist ihr Basisszenario?”
        - Basisszenario (60%)
        - Bull Case (20%)
        - Bear Case (20%)
        - Welche Daten entscheiden?
        ## 2.2 “Disagreement Map”
        ## 2.3 Market-Implications (übersetzt in Handeln)
        - 3–5 Wenn-Dann Sätze
        - Auswirkungen nach Asset-Klasse

        # 3) Crypto — Narrative, Trades, Risiken
        ## 3.1 Narrative Snapshot
        ## 3.2 Coin/Project Cards (Top 8–12)
        (pro Coin/Projekt:)
        - These (1–2 Sätze)
        - Catalyst-Kalender (wenn genannt)
        - Risiken
        - Checks (minimal; wenn nicht vorhanden → auslassen)
        - Evidence (IDs aus Appendix)
        ## 3.3 Macro-Link (Crypto als Risk Asset)

        # Appendix A — Evidence (Audit)
        - Erstelle Evidence-IDs (z.B. A-001, A-002 …).
        - Für jede ID:
          * Kategorie (Stocks/Macro/Crypto)
          * Entity (Ticker/Thema/Coin)
          * Channel (channel_namespace) + Video-Titel + Video-ID
          * transcript_path
          * role
          * quote (kurz, wörtlich)
          * Status: "Transkript-Fakt" | "Meinung/These" | "Externer Fakt nötig"
      en: |
        You are an investing analyst (stocks, macro, crypto).

        OUTPUT:
        - Write Markdown (not JSON).
        - Keep headings exactly as specified (no renaming).
        - Short sentences. Bullet points. No fluff.
        - No external facts. No invented numbers. Use only the aggregated extracts.
        - If missing: write "unknown" or omit (do not guess).
        - Source format (required): channel + video title + video id (if title missing: channel + video id).

        INPUT:
        - Aggregated per-video summaries (markdown-only) with fixed sections:
          * Summary
          * Key Points & Insights
          * Numbers
          * Chances
          * Risks
          * Unknowns
        - Use those fields only; do not add external facts.

        Definitions:
        - “Channel” = channel (channel_namespace).
        - “Evidence” = verbatim quotes from extracts.

        Follow the exact German template headings and structure, but write content in English.
